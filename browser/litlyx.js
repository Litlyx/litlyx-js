!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var i=e();for(var r in i)("object"==typeof exports?exports:t)[r]=i[r]}}(self,(()=>(()=>{"use strict";var t={};return((t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Lit=void 0;class i{workspace_id;settings;initialized=!1;hooked=!1;createInstance(){return new i}init(t,e){if(this.initialized)return console.warn("Already initialized");e?.debug&&console.log("INIT"),this.initialized=!0,this.workspace_id=t,this.settings={debug:!1,manualMode:!1,server:{host:"broker.litlyx.com",port:443,secure:!0},...e},this.settings.manualMode||(this.pushVisit(),this.hookHistory())}hookHistory(){if(this.hooked)return;this.hooked=!0;const t=this,e=history.pushState;history.pushState=function(i,r,s){e.apply(this,[i,r,s]),t.pushVisit()},addEventListener("popstate",(()=>t.pushVisit()))}async event(t,e){if(!this.initialized)return console.error("Not initialized");if(!this.workspace_id)return console.error("workspace_id is required");if(!this.settings)return console.error("You must call init before pushing");const i=e?.metadata?JSON.stringify(e.metadata):void 0;await this.sendRequest(this.workspace_id,"/event",{name:t,metadata:i,website:location.host||"SERVER_SIDE",userAgent:navigator.userAgent||"SERVER_SIDE"})}async pushVisit(t){if(!this.initialized)return console.error("Not initialized");if(!this.workspace_id)return console.error("workspace_id is required");if(!this.settings)return console.error("You must call init before pushing");const e=this.getUTM();await this.sendRequest(this.workspace_id,"/visit",{website:location.host,page:t??location.pathname,referrer:document.referrer||"self",userAgent:navigator.userAgent||"",...e})}getUTM(){try{const t=new URL(location.href).searchParams,e={};return t.forEach(((t,i)=>{i.startsWith("utm_")&&(e[i]=t)})),e}catch(t){return this.settings?.debug&&console.warn("Error parsing UTM parameters",t),[]}}sendRequest(t,e,i){const r=this.settings?.server;if(!r)return;const s=`${r.secure?"https":"http"}://${r.host}:${r.port}${e}`;fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...i,pid:t})}).catch((t=>{console.error("ERROR PUSHING",t)}))}}e.Lit=new i;const r=document.querySelector("script[data-workspace]")??document.querySelector("script[data-project]");if(r){const t=r.getAttribute("data-workspace")??r.getAttribute("data-project"),i=r.getAttribute("data-host"),s=r.getAttribute("data-port"),o=r.getAttribute("data-secure"),n=r.getAttribute("data-manual"),a=r.getAttribute("data-debug");t&&(console.log("Litlyx init on workspace",t),e.Lit.init(t,{manualMode:!!n&&"true"===n,debug:!!a&&"true"===a,server:{host:i||"broker.litlyx.com",port:s?parseInt(s):443,secure:!o||"true"===o}}))}})(0,t),t})()));